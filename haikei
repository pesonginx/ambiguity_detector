function countColorCellsByCell(rangeInput, colorCellInput) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();

  // rangeInput, colorCellInput は Range オブジェクトとして渡される前提
  const range = rangeInput;
  const colorCell = colorCellInput;

  const backgrounds = range.getBackgrounds();
  const targetColor = colorCell.getBackground();

  let count = 0;
  for (let row of backgrounds) {
    for (let color of row) {
      if (color.toLowerCase() === targetColor.toLowerCase()) {
        count++;
      }
    }
  }

  return count;
}
